/*********************************************************************************/
/********** THIS FILE IS GENERATED BY TOUCHGFX DESIGNER, DO NOT MODIFY ***********/
/*********************************************************************************/
#include <gui_generated/videointroscreen_screen/VideoIntroScreenViewBase.hpp>
#include <touchgfx/Color.hpp>
#include <videos/VideoDatabase.hpp>
#include <images/BitmapDatabase.hpp>

VideoIntroScreenViewBase::VideoIntroScreenViewBase() :
    fadeInBackgroundEndedCallback(this, &VideoIntroScreenViewBase::fadeInBackgroundEndedCallbackHandler),
    videoEndedCallback(this, &VideoIntroScreenViewBase::videoEndedCallbackHandler)
{
    __background.setPosition(0, 0, 800, 480);
    __background.setColor(touchgfx::Color::getColorFromRGB(0, 0, 0));
    add(__background);

    introVideo.setPosition(0, 0, 800, 480);
    introVideo.setVideoData(video_output_short_bin_start, video_output_short_bin_length);
    introVideo.setRepeat(false);
    introVideo.play();
    introVideo.setMovieEndedAction(videoEndedCallback);
    add(introVideo);

    lastVideoFrameImage.setXY(0, 0);
    lastVideoFrameImage.setBitmap(touchgfx::Bitmap(BITMAP_LAST_VIDEO_FRAME_ID));
    lastVideoFrameImage.setVisible(false);
    add(lastVideoFrameImage);

    backgroundImage.setXY(0, 0);
    backgroundImage.setBitmap(touchgfx::Bitmap(BITMAP_BLUE_BG_ID));
    backgroundImage.setAlpha(0);
    add(backgroundImage);
}

VideoIntroScreenViewBase::~VideoIntroScreenViewBase()
{

}

void VideoIntroScreenViewBase::setupScreen()
{

}

void VideoIntroScreenViewBase::videoEndedCallbackHandler(const touchgfx::VideoWidget& src)
{
    if (&src == &introVideo)
    {
        //FadeInBackground
        //When introVideo video ended fade backgroundImage
        //Fade backgroundImage to alpha:255 with LinearIn easing in 1000 ms (60 Ticks)
        backgroundImage.clearFadeAnimationEndedAction();
        backgroundImage.startFadeAnimation(255, 60, touchgfx::EasingEquations::linearEaseIn);
        backgroundImage.setFadeAnimationEndedAction(fadeInBackgroundEndedCallback);
        //replaceVideoWithImage
        //When introVideo video ended show lastVideoFrameImage
        //Show lastVideoFrameImage
        lastVideoFrameImage.setVisible(true);
        lastVideoFrameImage.invalidate();
    }
}

void VideoIntroScreenViewBase::fadeInBackgroundEndedCallbackHandler(const touchgfx::FadeAnimator<touchgfx::Image>& comp)
{
    //GoToMenuScreen
    //When FadeInBackground completed change screen to MenuLauncherScreen
    //Go to MenuLauncherScreen with no screen transition
    application().gotoMenuLauncherScreenScreenNoTransition();

}
